#!/bin/bash

[ "$1" == "" ] && echo "usage: $0 <package name> [init]" && exit

PREFIX=/usr/local
PACK=$1
BRANCH=trunk
TMP=/tmp/$PACK
TARGET=~/svn/$PACK/$BRANCH
SOURCE=http://$PACK.googlecode.com/svn/$BRANCH

if [ "$2" == "init" ]; then
    if [ -d  $TARGET ]; then
	svn up $TARGET
    else
	if [ "`svn ls $SOURCE`" == "$PACK/" ]; then
	    svn co $SOURCE/$PACK $TARGET
	else
	    svn co $SOURCE $TARGET
	fi
    fi
    if [ -e $TARGET/configure.ac ]; then
	(cd $TARGET ; aclocal ; autoconf ; automake)
	[ -d $TMP ] || mkdir -p $TMP
	(cd $TMP ; $TARGET/configure --prefix=$PREFIX)
    fi
fi

if [ -d $TMP ]; then
    MAKEDIR=$TMP
else
    MAKEDIR=$TARGET
fi

make -C $MAKEDIR && \
    sudo make -C $MAKEDIR install
