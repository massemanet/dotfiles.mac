# on the mac

## oneshot
sudo gem update --system
sudo gem update 
sudo gem install vagrant

## per box
### ubuntu - NAME=oneiric
### ubuntu - BOX=http://timhuegdon.com/vagrant-boxes/ubuntu-11.10.box
NAME=centos-6.2
BOX=http://packages.vstone.eu/vagrant-boxes/centos/6.2/centos-6.2-64bit-puppet-vbox.4.1.10-3.box

vagrant box add $NAME $BOX
mkdir -p ~/boxes/$NAME
ln ~/.ssh/id_rsa ~/boxes/$NAME
cd ~/boxes/$NAME
vagrant init $NAME

## per session
vagrant up
vagrant ssh -- -X

## my files - for emacs24
ln ~/Dropbox/masse/rpm/*rpm ~/boxes/$NAME
ln ~/Dropbox/masse/rpm/*repo ~/boxes/$NAME

# on the linux box

### ubuntu - sudo aptitude update
### ubuntu - sudo aptitude install git tmux python-software-properties deborphan
### ubuntu - sudo add-apt-repository ppa:cassou/emacs
### ubuntu - sudo aptitude install emacs-snapshot-nox

# CENTOS
## oneshot normal RPMs
### rpmforge
FORGE=`wget http://pkgs.repoforge.org/rpmforge-release -o /dev/null -O - \
 | grep _64 | grep -i centos-6 | cut -f6 -d"\"" | tail -1`
wget http://pkgs.repoforge.org/rpmforge-release/$FORGE -O/tmp/$FORGE
sudo rpm -i /tmp/$FORGE
### esl erlang
ESL=http://binaries.erlang-solutions.com
sudo wget $ESL/rpm/centos/erlang_solutions.repo -O /etc/yum.repos.d/esl.repo
sudo rpm --import $ESL/debian/erlang_solutions.asc

sudo yum --assumeyes update
sudo yum --assumeyes install git bash-completion man man-pages tmux esl-erlang dkms

## oneshot private RPMs - emacs24
sudo yum --assumeyes install /vagrant/liblockfile-1.08-9.el6.x86_64.rpm 
sudo yum --assumeyes install /vagrant/emacs-filesystem-24.0.93-3.el6.x86_64.rpm
sudo yum --assumeyes install /vagrant/emacs-common-24.0.93-3.el6.x86_64.rpm
sudo yum --assumeyes install /vagrant/emacs-nox-24.0.93-3.el6.x86_64.rpm

# oneshot dotfiles
cd
rm .* *
cp /vagrant/id_rsa ~/.ssh/
(cd /tmp ; git clone git@github.com:massemanet/dotfiles.centos.git)
mv /tmp/dotfiles.centos/.git ~
git reset --hard

## rebuild virtualbox guest additions
## typically needed after a kernel rebuild
sudo /etc/init.d/vboxadd setup

## klarna stuff
### graphviz
GV=http://www.graphviz.org/graphviz-rhel.repo
sudo wget $GV -O /etc/yum.repos.d/graphviz.repo
### dependencies
sudo yum install autoconf cracklib-devel ncurses-devel openssl-devel graphviz
### OTP
cd ~/git
git clone --branch otp_r14b03_klarna gitosis@git.hq.kred:otp.git
cd otp
./otp_build setup --prefix=/opt/otp/R14B03 force_linux_pthread_rwlocks=yes
sudo make install
### kred
cd ~git
git clone --recursive gitosis@git.hq.kred:dev.git
cd dev
PATH=/opt/otp/R14B03/bin:$PATH make -j4
## if config get stuck, e.g. if you change otp version;
git clean -fdx
## or
find . -name "*.beam" -exec rm {} \;
